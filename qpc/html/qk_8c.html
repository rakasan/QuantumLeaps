<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C: qk.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <a id="logo" title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">
    <img src="img/logo_ql.png" alt="Quantum Leaps" style="vertical-align:top; border:none;">
  </a>
  <span id="projectname">QP/C</span>
  <span id="projectnumber">6.9.1</span>
           <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('qk_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">qk.c File Reference<div class="ingroups"><a class="el" href="group__qk.html">QK</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>QK preemptive kernel implementation.
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;qf_port.h&quot;</code><br />
<code>#include &quot;<a class="el" href="qf__pkg_8h_source.html">qf_pkg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="qassert_8h_source.html">qassert.h</a>&quot;</code><br />
<code>#include &quot;qs_port.h&quot;</code><br />
<code>#include &quot;<a class="el" href="qs__pkg_8h_source.html">qs_pkg.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for qk.c:</div>
<div class="dyncontent">
<div class="center"><img src="qk_8c__incl.png" border="0" usemap="#aqk_8c" alt=""/></div>
</div>
</div>
<p><a href="qk_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adac7eccb860d910c4e446d3143798bba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#adac7eccb860d910c4e446d3143798bba">QF_init</a> (void)</td></tr>
<tr class="memdesc:adac7eccb860d910c4e446d3143798bba"><td class="mdescLeft">&#160;</td><td class="mdescRight">QF initialization.  <a href="qk_8c.html#adac7eccb860d910c4e446d3143798bba">More...</a><br /></td></tr>
<tr class="separator:adac7eccb860d910c4e446d3143798bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf9cb86740bf55c5ad55c1d44fd35921"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#adf9cb86740bf55c5ad55c1d44fd35921">QF_stop</a> (void)</td></tr>
<tr class="memdesc:adf9cb86740bf55c5ad55c1d44fd35921"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function invoked by the application layer to stop the QF application and return control to the OS/Kernel.  <a href="qk_8c.html#adf9cb86740bf55c5ad55c1d44fd35921">More...</a><br /></td></tr>
<tr class="separator:adf9cb86740bf55c5ad55c1d44fd35921"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdd3cebb48142880c0147c6f4eb3d131"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#acdd3cebb48142880c0147c6f4eb3d131">initial_events</a> (void)</td></tr>
<tr class="memdesc:acdd3cebb48142880c0147c6f4eb3d131"><td class="mdescLeft">&#160;</td><td class="mdescRight">process all events posted during initialization  <a href="qk_8c.html#acdd3cebb48142880c0147c6f4eb3d131">More...</a><br /></td></tr>
<tr class="separator:acdd3cebb48142880c0147c6f4eb3d131"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a779a1bc9482e2d489dc87751cd100fdb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="qassert_8h.html#ab6fd6105e64ed14a0c9281326f05e623">int_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#a779a1bc9482e2d489dc87751cd100fdb">QF_run</a> (void)</td></tr>
<tr class="memdesc:a779a1bc9482e2d489dc87751cd100fdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transfers control to QF to run the application.  <a href="qk_8c.html#a779a1bc9482e2d489dc87751cd100fdb">More...</a><br /></td></tr>
<tr class="separator:a779a1bc9482e2d489dc87751cd100fdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79d6304a4324086ed30a6f145625ab78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#a79d6304a4324086ed30a6f145625ab78">QActive_start_</a> (<a class="el" href="struct_q_active.html">QActive</a> *const me, <a class="el" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a> prio, <a class="el" href="struct_q_evt.html">QEvt</a> const **const qSto, <a class="el" href="16bit_2stdint_8h.html#a226d967fb6d06433caf43f20dc876aae">uint_fast16_t</a> const qLen, void *const stkSto, <a class="el" href="16bit_2stdint_8h.html#a226d967fb6d06433caf43f20dc876aae">uint_fast16_t</a> const stkSize, void const *const par)</td></tr>
<tr class="memdesc:a79d6304a4324086ed30a6f145625ab78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of the active object start operation.  <a href="qk_8c.html#a79d6304a4324086ed30a6f145625ab78">More...</a><br /></td></tr>
<tr class="separator:a79d6304a4324086ed30a6f145625ab78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d638caae0fbbaf0c0912e78205525c6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#a6d638caae0fbbaf0c0912e78205525c6">QK_schedLock</a> (<a class="el" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a> ceiling)</td></tr>
<tr class="memdesc:a6d638caae0fbbaf0c0912e78205525c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">QK Scheduler lock.  <a href="qk_8c.html#a6d638caae0fbbaf0c0912e78205525c6">More...</a><br /></td></tr>
<tr class="separator:a6d638caae0fbbaf0c0912e78205525c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad16b86d19848aa52a704b514c96373fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#ad16b86d19848aa52a704b514c96373fa">QK_schedUnlock</a> (<a class="el" href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a> stat)</td></tr>
<tr class="memdesc:ad16b86d19848aa52a704b514c96373fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">QK Scheduler unlock.  <a href="qk_8c.html#ad16b86d19848aa52a704b514c96373fa">More...</a><br /></td></tr>
<tr class="separator:ad16b86d19848aa52a704b514c96373fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49a6ff5d3a7c6ae58e33a2b943efb2fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc">QK_sched_</a> (void)</td></tr>
<tr class="memdesc:a49a6ff5d3a7c6ae58e33a2b943efb2fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">QK scheduler finds the highest-priority thread ready to run.  <a href="qk_8c.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc">More...</a><br /></td></tr>
<tr class="separator:a49a6ff5d3a7c6ae58e33a2b943efb2fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57768dcdb71b3e41f329bae839584399"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#a57768dcdb71b3e41f329bae839584399">QK_activate_</a> (void)</td></tr>
<tr class="memdesc:a57768dcdb71b3e41f329bae839584399"><td class="mdescLeft">&#160;</td><td class="mdescRight">QK activator activates the next active object.  <a href="qk_8c.html#a57768dcdb71b3e41f329bae839584399">More...</a><br /></td></tr>
<tr class="separator:a57768dcdb71b3e41f329bae839584399"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9c465b899f06067196a6633e0bc4c7b0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="qk_8h.html#struct_q_k___priv_attr">QK_PrivAttr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qk_8c.html#a9c465b899f06067196a6633e0bc4c7b0">QK_attr_</a></td></tr>
<tr class="memdesc:a9c465b899f06067196a6633e0bc4c7b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">global private attributes of the QK kernel  <a href="qk_8c.html#a9c465b899f06067196a6633e0bc4c7b0">More...</a><br /></td></tr>
<tr class="separator:a9c465b899f06067196a6633e0bc4c7b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>QK preemptive kernel implementation. </p>

<p class="definition">Definition in file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="adac7eccb860d910c4e446d3143798bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adac7eccb860d910c4e446d3143798bba">&#9670;&nbsp;</a></span>QF_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QF_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>QF initialization. </p>
<dl class="section user"><dt>Description</dt><dd>Initializes QF and must be called exactly once before any other QF function. Typically, <a class="el" href="qk_8c.html#adac7eccb860d910c4e446d3143798bba" title="QF initialization.">QF_init()</a> is called from main() even before initializing the Board Support Package (BSP).</dd></dl>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="qk_8c.html#adac7eccb860d910c4e446d3143798bba" title="QF initialization.">QF_init()</a> clears the internal QF variables, so that the framework can start correctly even if the startup code fails to clear the uninitialized data (as is required by the C Standard). </dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00072">72</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="adf9cb86740bf55c5ad55c1d44fd35921"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf9cb86740bf55c5ad55c1d44fd35921">&#9670;&nbsp;</a></span>QF_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QF_stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function invoked by the application layer to stop the QF application and return control to the OS/Kernel. </p>
<dl class="section user"><dt>Description</dt><dd>This function stops the QF application. After calling this function, QF attempts to gracefully stop the application. This graceful shutdown might take some time to complete. The typical use of this function is for terminating the QF application to return back to the operating system or for handling fatal errors that require shutting down (and possibly re-setting) the system.</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>After calling <a class="el" href="qk_8c.html#adf9cb86740bf55c5ad55c1d44fd35921" title="Function invoked by the application layer to stop the QF application and return control to the OS/Ker...">QF_stop()</a> the application must terminate and cannot continue. In particular, <a class="el" href="qk_8c.html#adf9cb86740bf55c5ad55c1d44fd35921" title="Function invoked by the application layer to stop the QF application and return control to the OS/Ker...">QF_stop()</a> is <b>not</b> intended to be followed by a call to <a class="el" href="qk_8c.html#adac7eccb860d910c4e446d3143798bba" title="QF initialization.">QF_init()</a> to "resurrect" the application.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="qf_8h.html#a5d7e181f2e679e1fa77c1e915fbee3e0" title="Cleanup QF callback.">QF_onCleanup()</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00107">107</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="acdd3cebb48142880c0147c6f4eb3d131"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdd3cebb48142880c0147c6f4eb3d131">&#9670;&nbsp;</a></span>initial_events()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void initial_events </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>process all events posted during initialization </p>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00115">115</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="a779a1bc9482e2d489dc87751cd100fdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a779a1bc9482e2d489dc87751cd100fdb">&#9670;&nbsp;</a></span>QF_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="qassert_8h.html#ab6fd6105e64ed14a0c9281326f05e623">int_t</a> QF_run </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transfers control to QF to run the application. </p>
<dl class="section user"><dt>Description</dt><dd><a class="el" href="qk_8c.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF to run the application.">QF_run()</a> is typically called from your startup code after you initialize the QF and start at least one active object with <a class="el" href="struct_q_active.html#a3123ef03f5d66d866da12c736ac574b0" title="Polymorphically start an active object.">QACTIVE_START()</a>.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>In QK, the <a class="el" href="qk_8c.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF to run the application.">QF_run()</a> does not return. </dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00133">133</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="a79d6304a4324086ed30a6f145625ab78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79d6304a4324086ed30a6f145625ab78">&#9670;&nbsp;</a></span>QActive_start_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QActive_start_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_q_active.html">QActive</a> *const&#160;</td>
          <td class="paramname"><em>me</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a>&#160;</td>
          <td class="paramname"><em>prio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_evt.html">QEvt</a> const **const&#160;</td>
          <td class="paramname"><em>qSto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="16bit_2stdint_8h.html#a226d967fb6d06433caf43f20dc876aae">uint_fast16_t</a> const&#160;</td>
          <td class="paramname"><em>qLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *const&#160;</td>
          <td class="paramname"><em>stkSto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="16bit_2stdint_8h.html#a226d967fb6d06433caf43f20dc876aae">uint_fast16_t</a> const&#160;</td>
          <td class="paramname"><em>stkSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *const&#160;</td>
          <td class="paramname"><em>par</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implementation of the active object start operation. </p>
<dl class="section user"><dt>Description</dt><dd>Starts execution of the AO and registers the AO with the framework. Also takes the top-most initial transition in the AO's state machine. This initial transition is taken in the callee's thread of execution.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">me</td><td>pointer (see <a class="el" href="index.html#oop">Object Orientation</a>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">prio</td><td>priority at which to start the active object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">qSto</td><td>pointer to the storage for the ring buffer of the event queue (used only with the built-in <a class="el" href="qequeue_8h.html#struct_q_e_queue" title="Native QF Event Queue.">QEQueue</a>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">qLen</td><td>length of the event queue [events] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stkSto</td><td>pointer to the stack storage (must be NULL in QK) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stkSize</td><td>stack size [bytes] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">par</td><td>pointer to an extra parameter (might be NULL).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function should be called via the macro <a class="el" href="struct_q_active.html#a3123ef03f5d66d866da12c736ac574b0" title="Polymorphically start an active object.">QACTIVE_START()</a>.</dd></dl>
<dl class="section user"><dt>Usage</dt><dd>The following example shows starting an AO when a per-task stack is needed: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="qpc_8h.html">qpc.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="qassert_8h.html#a27042866331f49c9e9ff4f3ef459eaaf">Q_DEFINE_THIS_FILE</a></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="keyword">static</span> Philo l_philo[N]; <span class="comment">/* N Philo active objects */</span></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="struct_q_evt.html">QEvt</a> <span class="keyword">const</span> *l_philQueueSto[N][N]; <span class="comment">/* storage for event queues */</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> l_philoStk[N][256];  <span class="comment">/* stacks for the Philo active objects */</span></div>
<div class="line"> </div>
<div class="line">    . . .</div>
<div class="line">    <span class="keywordflow">for</span> (n = 0; n &lt; N; ++n) {</div>
<div class="line">        TableEvt ie;  <span class="comment">/* initialization event for the Philo SM */</span></div>
<div class="line">        ie.philNum = n;</div>
<div class="line">        Philo_ctor(&amp;l_philo[n]);</div>
<div class="line">        <a class="code" href="struct_q_active.html#a3123ef03f5d66d866da12c736ac574b0">QACTIVE_START</a>((<a class="code" href="struct_q_active.html">QActive</a> *)&amp;l_philo[n],  <span class="comment">/* Philo pointer */</span></div>
<div class="line">            (<a class="code" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a>)(n*10 + 1),          <span class="comment">/* priority */</span></div>
<div class="line">            l_philoQueueSto[n], <a class="code" href="qassert_8h.html#ad58d2c6dc25f8f0f764eb69faa79eee2">Q_DIM</a>(l_philoQueueSto[n]), <span class="comment">/* queue */</span></div>
<div class="line">            l_philoStk[n], <span class="keyword">sizeof</span>(l_philoStk[n]), <span class="comment">/* per AO stack */</span></div>
<div class="line">            &amp;ie.super);                        <span class="comment">/* initialization event */</span></div>
<div class="line">    }</div>
<div class="line">    . . .</div>
<div class="line">} </div>
</div><!-- fragment --> </dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>AO cannot be started from an ISR, the priority must be in range and the stack storage must not be provided, because the QK kernel does not need per-AO stacks.</dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00175">175</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="a6d638caae0fbbaf0c0912e78205525c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d638caae0fbbaf0c0912e78205525c6">&#9670;&nbsp;</a></span>QK_schedLock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a> QK_schedLock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a>&#160;</td>
          <td class="paramname"><em>ceiling</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>QK Scheduler lock. </p>
<dl class="section user"><dt>Description</dt><dd>This function locks the QK scheduler to the specified ceiling.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ceiling</td><td>priority ceiling to which the QK scheduler needs to be locked</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The previous QK Scheduler lock status, which is to be used to unlock the scheduler by restoring its previous lock status in <a class="el" href="qk_8c.html#ad16b86d19848aa52a704b514c96373fa" title="QK Scheduler unlock.">QK_schedUnlock()</a>.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="qk_8c.html#a6d638caae0fbbaf0c0912e78205525c6" title="QK Scheduler lock.">QK_schedLock()</a> must be always followed by the corresponding <a class="el" href="qk_8c.html#ad16b86d19848aa52a704b514c96373fa" title="QK Scheduler unlock.">QK_schedUnlock()</a>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="qk_8c.html#ad16b86d19848aa52a704b514c96373fa" title="QK Scheduler unlock.">QK_schedUnlock()</a></dd></dl>
<dl class="section user"><dt>Usage</dt><dd>The following example shows how to lock and unlock the QK scheduler: <div class="fragment"><div class="line"><a class="code" href="16bit_2stdint_8h.html#a33594304e786b158f3fb30289278f5af">uint32_t</a> BSP_random(<span class="keywordtype">void</span>) { <span class="comment">/* a very cheap pseudo-random-number generator */</span></div>
<div class="line">    <a class="code" href="16bit_2stdint_8h.html#a33594304e786b158f3fb30289278f5af">uint32_t</a> rnd;</div>
<div class="line">    <a class="code" href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a> lockStat; <span class="comment">/* &lt;=== QK scheduler lock status */</span></div>
<div class="line"> </div>
<div class="line">    lockStat = <a class="code" href="qk_8h.html#a6d638caae0fbbaf0c0912e78205525c6">QK_schedLock</a>(N_PHILO); <span class="comment">/* &lt;=== lock scheduler up to N_PHILO prio */</span></div>
<div class="line">    <span class="comment">/* &quot;Super-Duper&quot; Linear Congruential Generator (LCG)</span></div>
<div class="line"><span class="comment">    * LCG(2^32, 3*7*11*13*23, 0, seed)</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    rnd = l_rnd * (3U*7U*11U*13U*23U);</div>
<div class="line">    l_rnd = rnd; <span class="comment">/* set for the next time */</span></div>
<div class="line">    <a class="code" href="qk_8h.html#ad16b86d19848aa52a704b514c96373fa">QK_schedUnlock</a>(lockStat); <span class="comment">/* &lt;=== unlock the scheduler */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (rnd &gt;&gt; 8);</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>The QK scheduler lock:<ul>
<li>cannot be called from an ISR;</li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00230">230</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="ad16b86d19848aa52a704b514c96373fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad16b86d19848aa52a704b514c96373fa">&#9670;&nbsp;</a></span>QK_schedUnlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QK_schedUnlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a>&#160;</td>
          <td class="paramname"><em>stat</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>QK Scheduler unlock. </p>
<dl class="section user"><dt>Description</dt><dd>This function unlocks the QK scheduler to the previous status.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">stat</td><td>previous QK Scheduler lock status returned from <a class="el" href="qk_8c.html#a6d638caae0fbbaf0c0912e78205525c6" title="QK Scheduler lock.">QK_schedLock()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="qk_8c.html#ad16b86d19848aa52a704b514c96373fa" title="QK Scheduler unlock.">QK_schedUnlock()</a> must always follow the corresponding <a class="el" href="qk_8c.html#a6d638caae0fbbaf0c0912e78205525c6" title="QK Scheduler lock.">QK_schedLock()</a>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="qk_8c.html#a6d638caae0fbbaf0c0912e78205525c6" title="QK Scheduler lock.">QK_schedLock()</a></dd></dl>
<dl class="section user"><dt>Usage</dt><dd>The following example shows how to lock and unlock the QK scheduler: <div class="fragment"><div class="line"><a class="code" href="16bit_2stdint_8h.html#a33594304e786b158f3fb30289278f5af">uint32_t</a> BSP_random(<span class="keywordtype">void</span>) { <span class="comment">/* a very cheap pseudo-random-number generator */</span></div>
<div class="line">    <a class="code" href="16bit_2stdint_8h.html#a33594304e786b158f3fb30289278f5af">uint32_t</a> rnd;</div>
<div class="line">    <a class="code" href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a> lockStat; <span class="comment">/* &lt;=== QK scheduler lock status */</span></div>
<div class="line"> </div>
<div class="line">    lockStat = <a class="code" href="qk_8h.html#a6d638caae0fbbaf0c0912e78205525c6">QK_schedLock</a>(N_PHILO); <span class="comment">/* &lt;=== lock scheduler up to N_PHILO prio */</span></div>
<div class="line">    <span class="comment">/* &quot;Super-Duper&quot; Linear Congruential Generator (LCG)</span></div>
<div class="line"><span class="comment">    * LCG(2^32, 3*7*11*13*23, 0, seed)</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    rnd = l_rnd * (3U*7U*11U*13U*23U);</div>
<div class="line">    l_rnd = rnd; <span class="comment">/* set for the next time */</span></div>
<div class="line">    <a class="code" href="qk_8h.html#ad16b86d19848aa52a704b514c96373fa">QK_schedUnlock</a>(lockStat); <span class="comment">/* &lt;=== unlock the scheduler */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (rnd &gt;&gt; 8);</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd>The scheduler cannot be unlocked:<ul>
<li>from the ISR context; and</li>
<li>the current lock priority must be greater than the previous</li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00280">280</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="a49a6ff5d3a7c6ae58e33a2b943efb2fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49a6ff5d3a7c6ae58e33a2b943efb2fc">&#9670;&nbsp;</a></span>QK_sched_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a> QK_sched_ </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>QK scheduler finds the highest-priority thread ready to run. </p>
<dl class="section user"><dt>Description</dt><dd>The QK scheduler finds out the priority of the highest-priority AO that (1) has events to process and (2) has priority that is above the current priority.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>the 1-based priority of the the active object, or zero if no eligible active object is ready to run.</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd><a class="el" href="qk_8c.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK scheduler finds the highest-priority thread ready to run.">QK_sched_()</a> must be always called with interrupts <b>disabled</b> and returns with interrupts <b>disabled</b>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00329">329</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<a id="a57768dcdb71b3e41f329bae839584399"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57768dcdb71b3e41f329bae839584399">&#9670;&nbsp;</a></span>QK_activate_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QK_activate_ </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>QK activator activates the next active object. </p>
<dl class="section user"><dt>Description</dt><dd><a class="el" href="qk_8c.html#a57768dcdb71b3e41f329bae839584399" title="QK activator activates the next active object.">QK_activate_()</a> activates ready-to run AOs that are above the initial active priority (QK_attr_.actPrio).</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The activator might enable interrupts internally, but always returns with interrupts <b>disabled</b>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00359">359</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9c465b899f06067196a6633e0bc4c7b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c465b899f06067196a6633e0bc4c7b0">&#9670;&nbsp;</a></span>QK_attr_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="qk_8h.html#struct_q_k___priv_attr">QK_PrivAttr</a> QK_attr_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>global private attributes of the QK kernel </p>

<p class="definition">Definition at line <a class="el" href="qk_8c_source.html#l00059">59</a> of file <a class="el" href="qk_8c_source.html">qk.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aqpc_8h_html"><div class="ttname"><a href="qpc_8h.html">qpc.h</a></div><div class="ttdoc">QP/C public interface including backwards-compatibility layer.</div></div>
<div class="ttc" id="aqassert_8h_html_a27042866331f49c9e9ff4f3ef459eaaf"><div class="ttname"><a href="qassert_8h.html#a27042866331f49c9e9ff4f3ef459eaaf">Q_DEFINE_THIS_FILE</a></div><div class="ttdeci">#define Q_DEFINE_THIS_FILE</div><div class="ttdoc">Define the file name (with __FILE__) for assertions in this file.</div><div class="ttdef"><b>Definition:</b> <a href="qassert_8h_source.html#l00104">qassert.h:104</a></div></div>
<div class="ttc" id="astruct_q_active_html_a3123ef03f5d66d866da12c736ac574b0"><div class="ttname"><a href="struct_q_active.html#a3123ef03f5d66d866da12c736ac574b0">QActive::QACTIVE_START</a></div><div class="ttdeci">#define QACTIVE_START(me_, prio_, qSto_, qLen_, stkSto_, stkLen_, par_)</div><div class="ttdoc">Polymorphically start an active object.</div><div class="ttdef"><b>Definition:</b> <a href="qf_8h_source.html#l00216">qf.h:216</a></div></div>
<div class="ttc" id="aqassert_8h_html_ad58d2c6dc25f8f0f764eb69faa79eee2"><div class="ttname"><a href="qassert_8h.html#ad58d2c6dc25f8f0f764eb69faa79eee2">Q_DIM</a></div><div class="ttdeci">#define Q_DIM(array_)</div><div class="ttdoc">Helper macro to calculate static dimension of a 1-dim array_.</div><div class="ttdef"><b>Definition:</b> <a href="qassert_8h_source.html#l00337">qassert.h:337</a></div></div>
<div class="ttc" id="astruct_q_active_html"><div class="ttname"><a href="struct_q_active.html">QActive</a></div><div class="ttdoc">Active Object base class (based on QHsm implementation)</div><div class="ttdef"><b>Definition:</b> <a href="qf_8h_source.html#l00116">qf.h:116</a></div></div>
<div class="ttc" id="a16bit_2stdint_8h_html_ad0906fbe05a45fbdb000c58fe8929e70"><div class="ttname"><a href="16bit_2stdint_8h.html#ad0906fbe05a45fbdb000c58fe8929e70">uint_fast8_t</a></div><div class="ttdeci">unsigned int uint_fast8_t</div><div class="ttdoc">fast at-least 8-bit unsigned int</div><div class="ttdef"><b>Definition:</b> <a href="16bit_2stdint_8h_source.html#l00036">16bit/stdint.h:36</a></div></div>
<div class="ttc" id="aqk_8h_html_a388523c5421884e53d2f3f7523349c0e"><div class="ttname"><a href="qk_8h.html#a388523c5421884e53d2f3f7523349c0e">QSchedStatus</a></div><div class="ttdeci">uint_fast16_t QSchedStatus</div><div class="ttdoc">QK Scheduler locking.</div><div class="ttdef"><b>Definition:</b> <a href="qk_8h_source.html#l00132">qk.h:132</a></div></div>
<div class="ttc" id="astruct_q_evt_html"><div class="ttname"><a href="struct_q_evt.html">QEvt</a></div><div class="ttdoc">Event class.</div><div class="ttdef"><b>Definition:</b> <a href="qep_8h_source.html#l00151">qep.h:151</a></div></div>
<div class="ttc" id="aqk_8h_html_a6d638caae0fbbaf0c0912e78205525c6"><div class="ttname"><a href="qk_8h.html#a6d638caae0fbbaf0c0912e78205525c6">QK_schedLock</a></div><div class="ttdeci">QSchedStatus QK_schedLock(uint_fast8_t ceiling)</div><div class="ttdoc">QK Scheduler lock.</div><div class="ttdef"><b>Definition:</b> <a href="qk_8c_source.html#l00230">qk.c:230</a></div></div>
<div class="ttc" id="aqk_8h_html_ad16b86d19848aa52a704b514c96373fa"><div class="ttname"><a href="qk_8h.html#ad16b86d19848aa52a704b514c96373fa">QK_schedUnlock</a></div><div class="ttdeci">void QK_schedUnlock(QSchedStatus stat)</div><div class="ttdoc">QK Scheduler unlock.</div><div class="ttdef"><b>Definition:</b> <a href="qk_8c_source.html#l00280">qk.c:280</a></div></div>
<div class="ttc" id="a16bit_2stdint_8h_html_a33594304e786b158f3fb30289278f5af"><div class="ttname"><a href="16bit_2stdint_8h.html#a33594304e786b158f3fb30289278f5af">uint32_t</a></div><div class="ttdeci">unsigned long int uint32_t</div><div class="ttdoc">exact-width 32-bit unsigned int</div><div class="ttdef"><b>Definition:</b> <a href="16bit_2stdint_8h_source.html#l00031">16bit/stdint.h:31</a></div></div>
<!-- start footer part -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
      <ul>
        <li class="navelem"><a class="el" href="dir_28a04cc6444cdd1b436423abf3214ac3.html">src</a></li><li class="navelem"><a class="el" href="dir_cea592f63ae23c26ec712f9b20161ccc.html">qk</a></li><li class="navelem"><a class="el" href="qk_8c.html">qk.c</a></li>
        <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QP/C 6.9.1</b>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QP/C 6.9.1</b>
</small></address>
        </li>
      </ul>
    </div>
    <script src="custom.js"></script>
  </body>
</html>
